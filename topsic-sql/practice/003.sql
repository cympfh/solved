WITH P2015 AS (
    SELECT
        PF_CODE,
        TOTAL_AMT
    FROM POPU_TRANSITION
    WHERE SURVEY_YEAR = 2015
),

P2020 AS (
    SELECT
        PF_CODE,
        TOTAL_AMT
    FROM POPU_TRANSITION
    WHERE SURVEY_YEAR = 2020
)

SELECT
    PREFECTURE.PF_CODE AS `都道府県コード`,
    PREFECTURE.PF_NAME AS `都道府県名`,
    P2015.TOTAL_AMT AS `総人口2015年`,
    P2020.TOTAL_AMT AS `総人口2020年`,
    ROUND(100.0 * P2020.TOTAL_AMT / P2015.TOTAL_AMT) AS `人口増加率`
FROM PREFECTURE
INNER JOIN P2015 ON P2015.PF_CODE = PREFECTURE.PF_CODE
INNER JOIN P2020 ON P2020.PF_CODE = PREFECTURE.PF_CODE
WHERE
    P2015.TOTAL_AMT < P2020.TOTAL_AMT
ORDER BY
    `人口増加率` DESC,
    PREFECTURE.PF_CODE ASC;
